{
  "openapi": "3.0.0",
  "info": {
    "title": "Reflections API - GET",
    "version": "1.0.0",
    "description": "Fetch recent user reflections with calculated recency weights"
  },
  "paths": {
    "/api/reflections": {
      "get": {
        "summary": "Get recent reflections",
        "description": "Fetches the 5 most recent reflections for the authenticated user, sorted by creation date descending. Each reflection includes a calculated recency weight using exponential decay formula.",
        "operationId": "getReflections",
        "tags": ["Reflections"],
        "security": [
          {
            "supabaseAuth": []
          }
        ],
        "parameters": [
          {
            "name": "limit",
            "in": "query",
            "description": "Maximum number of reflections to return (default: 5, max: 10)",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "default": 5
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully retrieved reflections",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "reflections": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/ReflectionWithWeight"
                      },
                      "description": "Array of reflections with calculated weights, sorted by created_at DESC"
                    }
                  },
                  "required": ["reflections"]
                },
                "example": {
                  "reflections": [
                    {
                      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
                      "user_id": "user-uuid-here",
                      "text": "Feeling burnt out, need lighter tasks today",
                      "created_at": "2025-10-16T14:30:00Z",
                      "weight": 1.0,
                      "relative_time": "Just now"
                    },
                    {
                      "id": "b2c3d4e5-f6a7-8901-bcde-f12345678901",
                      "user_id": "user-uuid-here",
                      "text": "Client call went well, momentum building",
                      "created_at": "2025-10-14T10:15:00Z",
                      "weight": 0.76,
                      "relative_time": "2 days ago"
                    },
                    {
                      "id": "c3d4e5f6-a7b8-9012-cdef-123456789012",
                      "user_id": "user-uuid-here",
                      "text": "Back-to-back meetings, only 30min blocks",
                      "created_at": "2025-10-11T09:00:00Z",
                      "weight": 0.57,
                      "relative_time": "5 days ago"
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - no valid session",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "Unauthorized",
                  "message": "No active session found"
                }
              }
            }
          },
          "500": {
            "description": "Internal server error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "Internal Server Error",
                  "message": "Failed to fetch reflections"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "supabaseAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Supabase JWT access token"
      }
    },
    "schemas": {
      "ReflectionWithWeight": {
        "type": "object",
        "description": "Reflection with calculated recency weight and formatted timestamp",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "Unique reflection identifier"
          },
          "user_id": {
            "type": "string",
            "format": "uuid",
            "description": "User who created the reflection"
          },
          "text": {
            "type": "string",
            "minLength": 10,
            "maxLength": 500,
            "description": "Reflection content (plain text)"
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of creation"
          },
          "weight": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 1,
            "description": "Calculated recency weight using exponential decay (0.5^(age_in_days/7))"
          },
          "relative_time": {
            "type": "string",
            "description": "Human-readable relative timestamp (e.g., 'Just now', '3 hours ago', '2 days ago', '7+ days ago')",
            "examples": ["Just now", "3 hours ago", "2 days ago", "7+ days ago"]
          }
        },
        "required": ["id", "user_id", "text", "created_at", "weight", "relative_time"]
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Error type"
          },
          "message": {
            "type": "string",
            "description": "Human-readable error message"
          }
        },
        "required": ["error", "message"]
      }
    }
  }
}
